i:0:0
n:`I$3$i
/
 20
134
\
k:(1 0;0 0
-1 1;0 1;1 1
-1 2;0 2;1 2
-1 3;0 3;1 3)
k2:(1 1;-1 0;0 1;0 0;1 0)
kd:(0 0;-1 0;0 1;0 -1;1 0)

d1:,/0{((0|/-1 0~/:k[y]+\kd@)|:/.1<:\,/(k[x]-k[y])#'(4 4 1 1;2 2 2 3 3 3)),0}':"A0123456789"?
d2:,/0{((0|/-1 1~/:k2[y]+\kd@)|:/.1<:\,/(k2[x]-k2[y])#'(4 4 1 1;2 2 3 3)),0}':

+/n*(#2 d2/d1@)'i
