(i;v):{(,/100$,/'("#O.@"!("##";"[]";"..";"@."))@/:"\n"\x;(("<^>v"!-1 -100 1 100)y)^0N)}."\n\n"\1:0
(*&i="@"){f:$[1=y|-y;(~^"[]"?i@)(y+)\y+x;(.1<:\?,/{x^("[]"!(x+0 1,y;x+0 -1,y))i x}[;y]')/,x+y]
$[^i[f]?"#";[f:(^"[]"?i@)_f;t:i f;i[f]:".";i[f+y]:t;x+y];x]}/v;
+/&i="["
